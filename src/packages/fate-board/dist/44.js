"use strict";(self.webpackChunkfate_board=self.webpackChunkfate_board||[]).push([[44],{71044:(a,e,t)=>{t.r(e),t.d(e,{default:()=>ma});var s=t(32288),l=t(12416),i=t(51784),n=t(9596),o=t(73709);const g={class:"f-dashboard-graphic"},c={class:"f-dashboard-graphic-title"},r=(a=>((0,s.Qi)("data-v-3a45c30b"),a=a(),(0,s.jt)(),a))((()=>(0,s.Lk)("span",null,"Graph",-1))),d={class:"f-dashboard-chart"},u={class:"fb-dag-dialog"},I=(0,s.pM)({__name:"DAG",setup(a){const e=(0,o.Pj)(),t=(0,l.KR)(!0),i=(0,s.EW)((()=>e.state.job.dag)),n=()=>{t.value=!1},I=(0,l.KR)(!1),h=()=>{I.value=!0};return(a,e)=>{const l=(0,s.g2)("FullScreen"),o=(0,s.g2)("el-icon"),b=(0,s.g2)("FDag"),C=(0,s.g2)("el-dialog"),p=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("section",g,[(0,s.Lk)("article",c,[r,(0,s.bF)(o,{class:"f-dashboard-graohic-icon",onClick:h},{default:(0,s.k6)((()=>[(0,s.bF)(l)])),_:1})]),(0,s.Lk)("section",d,[(0,s.bo)((0,s.bF)(b,{data:i.value,operation:!1,mini:!0,onLoaded:n,class:"f-dashboard-dag"},null,8,["data"]),[[p,t.value]])]),(0,s.bF)(C,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),title:"DAG",width:"80%","append-to-body":""},{default:(0,s.k6)((()=>[(0,s.Lk)("section",u,[(0,s.bo)((0,s.bF)(b,{data:i.value,onLoaded:n,class:"f-dashboard-dag"},null,8,["data"]),[[p,t.value]])])])),_:1},8,["modelValue"])])}}});var h=t(47433);const b=(0,h.A)(I,[["__scopeId","data-v-3a45c30b"]]);var C=t(66500);const p=a=>((0,s.Qi)("data-v-52187617"),a=a(),(0,s.jt)(),a),f={class:"f-dashboard-gauge"},m={class:"f-dashboard-gauge--title"},v={class:"f-dashboard-gauge--duration"},k={class:"f-dashboard-gauge--status"},A=p((()=>(0,s.Lk)("article",{class:"f-dashboard-gauge--label"},"status :",-1))),L={class:"f-dashboard-gauge--content"},y={class:"f-dashboard-gauge--icon"},T={key:0,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgdmlld0JveD0iMCAwIDE4IDE4Ij4NCiAgPGRlZnM+DQogICAgPHN0eWxlPg0KICAgICAgLmNscy0xLCAuY2xzLTMgew0KICAgICAgICBmaWxsOiBub25lOw0KICAgICAgfQ0KDQogICAgICAuY2xzLTEgew0KICAgICAgICBzdHJva2U6ICMyNGI2OGI7DQogICAgICAgIHN0cm9rZS13aWR0aDogMnB4Ow0KICAgICAgfQ0KDQogICAgICAuY2xzLTIgew0KICAgICAgICBzdHJva2U6IG5vbmU7DQogICAgICB9DQogICAgPC9zdHlsZT4NCiAgPC9kZWZzPg0KICA8ZyBpZD0i57uEXzE5MTUiIGRhdGEtbmFtZT0i57uEIDE5MTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC05NjYgLTU5OCkiPg0KICAgIDxnIGlkPSLmpK3lnIZfMjczIiBkYXRhLW5hbWU9IuakreWchiAyNzMiIGNsYXNzPSJjbHMtMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTY2IDU5OCkiPg0KICAgICAgPGNpcmNsZSBjbGFzcz0iY2xzLTIiIGN4PSI5IiBjeT0iOSIgcj0iOSIvPg0KICAgICAgPGNpcmNsZSBjbGFzcz0iY2xzLTMiIGN4PSI5IiBjeT0iOSIgcj0iOCIvPg0KICAgIDwvZz4NCiAgICA8cGF0aCBpZD0i6Lev5b6EXzUxIiBkYXRhLW5hbWU9Iui3r+W+hCA1MSIgY2xhc3M9ImNscy0xIiBkPSJNMTEzMC4yLDM2OS41MThsMy44NzIsMy43MzEsNS45NDYtNS43MjciIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTkuOTg2IDIzNi43MykiLz4NCiAgPC9nPg0KPC9zdmc+DQo=",class:"f-dashboard-gauge--img",alt:""},z={key:1,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgdmlld0JveD0iMCAwIDE4IDE4Ij4NCiAgPGRlZnM+DQogICAgPHN0eWxlPg0KICAgICAgLmNscy0xLCAuY2xzLTMgew0KICAgICAgICBmaWxsOiBub25lOw0KICAgICAgfQ0KDQogICAgICAuY2xzLTEgew0KICAgICAgICBzdHJva2U6ICNmZjY0NjQ7DQogICAgICAgIHN0cm9rZS13aWR0aDogMnB4Ow0KICAgICAgfQ0KDQogICAgICAuY2xzLTIgew0KICAgICAgICBzdHJva2U6IG5vbmU7DQogICAgICB9DQogICAgPC9zdHlsZT4NCiAgPC9kZWZzPg0KICA8ZyBpZD0i57uEXzE5MTYiIGRhdGEtbmFtZT0i57uEIDE5MTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC05NjYgLTYzNikiPg0KICAgIDxnIGlkPSLmpK3lnIZfNjMiIGRhdGEtbmFtZT0i5qSt5ZyGIDYzIiBjbGFzcz0iY2xzLTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk2NiA2MzYpIj4NCiAgICAgIDxjaXJjbGUgY2xhc3M9ImNscy0yIiBjeD0iOSIgY3k9IjkiIHI9IjkiLz4NCiAgICAgIDxjaXJjbGUgY2xhc3M9ImNscy0zIiBjeD0iOSIgY3k9IjkiIHI9IjgiLz4NCiAgICA8L2c+DQogICAgPGxpbmUgaWQ9IuebtOe6v18xMTYiIGRhdGEtbmFtZT0i55u057q/IDExNiIgY2xhc3M9ImNscy0xIiB4Mj0iNiIgeTI9IjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk3MiA2NDIpIi8+DQogICAgPGxpbmUgaWQ9IuebtOe6v18xMTciIGRhdGEtbmFtZT0i55u057q/IDExNyIgY2xhc3M9ImNscy0xIiB4MT0iNiIgeTI9IjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk3MiA2NDIpIi8+DQogIDwvZz4NCjwvc3ZnPg0K",class:"f-dashboard-gauge--img",alt:""},S={class:"f-dashboard-gauge--duration"},D=p((()=>(0,s.Lk)("article",{class:"f-dashboard-gauge--label"},"duration :",-1))),M={class:"f-dashboard-gauge--content"},N=(0,s.pM)({__name:"Gauge",setup(a){const e=(0,o.Pj)(),t=(0,s.EW)((()=>e.state.job.jobId)),n=(0,s.EW)((()=>e.state.job.details.fStatus)),g=(0,l.KR)(0),c=(0,s.EW)((()=>e.state.job.details.fProgress)),r=()=>{e.dispatch("toDetail")},d=()=>{let a=e.state.job.details.fElapsed;a||(a=Math.floor(e.state.job.details.fStartTime?(new Date).getTime()-e.state.job.details.fStartTime:0)),g.value=a},u=()=>{setTimeout((()=>{n.value.match(/running/i)?(g.value+=1e3,u()):d()}),1e3)};return(0,s.wB)((()=>n.value),(a=>{a.match(/running/i)&&u()})),(0,s.wB)((()=>e.state.job.details.fElapsed),(()=>d())),(0,s.wB)((()=>e.state.job.details.fStartTime),(()=>d())),(0,s.sV)((()=>{d(),n.value&&n.value.match(/running/i)&&u()})),(a,e)=>{const o=(0,s.g2)("FGauge"),d=(0,s.g2)("Right"),u=(0,s.g2)("el-icon"),I=(0,s.g2)("el-button");return(0,s.uX)(),(0,s.CE)("section",f,[(0,s.Lk)("article",m,"JOB: "+(0,i.toDisplayString)(t.value),1),(0,s.Lk)("section",{class:(0,i.normalizeClass)(["f-dashboard-gauge--main",{"f-dashboard-gauge--running":n.value&&!n.value.match(/success|fail/i)}])},[n.value&&!n.value.match(/success|fail/i)?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.bF)(o,{class:"f-dashboard-gauge--progress",precentage:c.value||0},null,8,["precentage"]),(0,s.Lk)("article",v,(0,i.toDisplayString)((0,l.R1)(C.toTime)(g.value)),1)],64)):n.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("article",k,[A,(0,s.Lk)("article",L,(0,i.toDisplayString)(n.value),1)]),(0,s.Lk)("article",y,[n.value.match(/success/i)?((0,s.uX)(),(0,s.CE)("img",T)):(0,s.Q3)("v-if",!0),n.value.match(/success/i)?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.CE)("img",z))]),(0,s.Lk)("article",S,[D,(0,s.Lk)("article",M,(0,i.toDisplayString)((0,l.R1)(C.toTime)(g.value)),1)])],64)):(0,s.Q3)("v-if",!0),(0,s.bF)(I,{class:"f-dashboard-gauge--btn",onClick:r},{default:(0,s.k6)((()=>[(0,s.eW)("To Detail"),(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(d)])),_:1})])),_:1})],2)])}}}),j=(0,h.A)(N,[["__scopeId","data-v-52187617"]]);var x=t(45250);const E=a=>((0,s.Qi)("data-v-288d7f49"),a=a(),(0,s.jt)(),a),w={class:"f-dashboard-dataset"},F=E((()=>(0,s.Lk)("article",{class:"f-dashboard-dataset--title"},"Parties info",-1))),P={class:"f-dashboard-dataset--main"},K={class:"f-dashboard-dataset--label"},Y=E((()=>(0,s.Lk)("article",{class:"f-dashboard-dataset--label"},"Dataset",-1))),R={class:"f-dashboard-dataset--content"},_={class:"f-dashboard-dataset--column"},G={class:"f-dashboard-dataset--content"},Z=(0,s.pM)({__name:"Information",setup(a){const e=(0,o.Pj)(),t=(0,s.EW)((()=>e.state.job.dataset.dataset||{}));return(a,e)=>{const n=(0,s.g2)("el-col"),o=(0,s.g2)("el-row");return(0,s.uX)(),(0,s.CE)("article",w,[F,(0,s.Lk)("section",P,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.value,((a,e)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(o,{gutter:24,class:"f-dashboard-dataset--row f-dashboard-dataset--subtitle"},{default:(0,s.k6)((()=>[(0,s.bF)(n,{span:8},{default:(0,s.k6)((()=>[(0,s.Lk)("article",K,(0,i.toDisplayString)((0,l.R1)(x.capitalize)(e.toString()||"")),1)])),_:2},1024),(0,s.bF)(n,{span:16},{default:(0,s.k6)((()=>[Y])),_:1})])),_:2},1024),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a,((a,e)=>((0,s.uX)(),(0,s.Wv)(o,{gutter:24,class:"f-dashboard-dataset--row"},{default:(0,s.k6)((()=>[(0,s.bF)(n,{span:8},{default:(0,s.k6)((()=>[(0,s.Lk)("article",R,(0,i.toDisplayString)(e),1)])),_:2},1024),(0,s.bF)(n,{span:16},{default:(0,s.k6)((()=>[(0,s.Lk)("article",_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a,((a,e)=>((0,s.uX)(),(0,s.CE)("article",G,(0,i.toDisplayString)(`${a.namespace}.${a.name}`),1)))),256))])])),_:2},1024)])),_:2},1024)))),256))],64)))),256))])])}}}),H=(0,h.A)(Z,[["__scopeId","data-v-288d7f49"]]);var X=t(72746);const B={class:"f-log"},W={class:"f-log-tabs"},O={class:"f-log-tab"},Q=["onClick"],J={class:"f-log-info"},U={class:"f-log-subtabs"},V=["onClick"],$={class:"f-log-subtab-content"},q={class:"f-log-containers"},aa={ref:"checklog",class:"f-log-expended"};var ea=t(93935),ta=t(15644),sa=t(96977);const la=["partyError","partyWarning","partyInfo","partyDebug","jobSchedule","jobError"],[ia,na,oa,ga,ca,ra]=la,da={logSize:"logSize",log:"log",[ia]:"log",[na]:"log",[oa]:"log",[ga]:"log",[ca]:"log",[ra]:"log"};function ua(a,e,...t){return{tabs:a,current:e,...t}}const Ia={components:{LoggerScroll:sa.A},data:()=>({currentMainTab:"algorithm",algorithmTab:ua({[ia]:"error",[na]:"warning",[oa]:"info",[ga]:"debug"},oa),scheduleTab:ua({[ca]:"info",[ra]:"error"},ca),logs:{},counts:{},logSizeHasRecevied:!1,expandAll:!1,instanceId:[],currentInstanceId:"",runningInterval:null}),computed:{...(0,o.aH)({jobId:a=>a.job.jobId,role:a=>a.job.role,partyId:a=>a.job.partyId}),LOG_TYPES:()=>la,mainTabs(){return{algorithm:this.algorithmTab,schedule:this.scheduleTab}},currentLogType(){return this.mainTabs[this.currentMainTab]&&this.mainTabs[this.currentMainTab].current},instanceSelection(){const a=[];for(const e of this.instanceId)a.push({label:e,value:e});return a}},watch:{logSizeHasRecevied(a){a&&this.onPull(this.currentLogType)},counts:{handler(a,e){for(const t in a)a.hasOwnProperty(t)&&a[t]!==e[t]&&t===this.currentLogType&&this.onPull(t,!1)},deep:!0}},created(){this.getInstanceIdFromFlow().then((()=>{this.initLogSocket()}))},beforeDestroy(){this.runningInterval&&clearInterval(this.runningInterval),this.ws&&this.ws.close()},methods:{capitalize:a=>a.substring(0,1).toUpperCase()+a.substring(1),changeMainTab(a){this.currentMainTab!==a&&(this.currentMainTab=a,this.shouldInitLogByType(this.currentLogType))},changeSubTab(a){this.currentLogType!==a&&(this.mainTabs[this.currentMainTab].current=a,this.shouldInitLogByType(a))},shouldInitLogByType(a){return!this.logs[a+"_"+this.currentInstanceId]&&this.onPull(a)},getInstanceIdFromFlow(){return ea.A.getInstanceId().then((a=>{const e=[];for(const t of Object.values(a))t.host===window.location.host&&(this.currentInstanceId=t.instance_id),e.push(t.instance_id);this.currentInstanceId||(this.currentInstanceId=e[0]),this.instanceId=e}))},initLogSocket(){return this.ws||(this.jobId&&this.role&&this.partyId||console.warn("Missing required parameters"),this.ws=new C.WSConnect(`/log/new/${this.jobId}/${this.role}/${this.partyId}/default`),this.ws.addEventListener("message",(a=>{try{const e={data:JSON.parse(a.data)};void 0!==e.data[ra]?e.type="logSize":e.type="log",this.handleLogMessage(e)}catch(a){(0,ta.nk)({showClose:!0,message:"This job socket has error",center:!0,type:"error"})}})),this.ws.addEventListener("open",(()=>{this.intervalPull()}))),this.ws},handleLogMessage(a){switch(da[a.type]){case"logSize":this.handleLogSizeResponse(a.data);break;case"log":this.insertLogs(a.data)}},handleLogSizeResponse(a){this.logSizeHasRecevied||(this.logSizeHasRecevied=!0),this.setLogSize(a)},setLogSize(a){this.counts=Object.assign({},this.counts,a)},onPull(a,e=!0){const t=this.counts[a],s=this.logs[a+"_"+this.currentInstanceId]||[],l=this.currentInstanceId;let i,n;if(s.length?e?(n=parseFloat(s[0].lineNum)-1,i=Math.max(1,n-50)):(i=parseFloat(s[s.length-1].lineNum)+1,n=t):(n=t,i=Math.max(n-50,1)),t>0){if(n<i)return;this.ws&&this.ws.send(JSON.stringify({instanceId:l,type:a,begin:i,end:n}))}else this.logs[a+"_"+this.currentInstanceId]=[]},onCountPull(){const a=this.currentInstanceId;this.ws.send(JSON.stringify({type:"logSize",instanceId:a}))},intervalPull(){this.runningInterval||(this.onCountPull(),this.runningInterval=setInterval((()=>{this.onCountPull()}),1e4))},insertLogs(a){const{type:e,data:t}=a,s=this.logs[e+"_"+this.currentInstanceId]||[];let l=[];if(s.length){const a=this.getLogsRange(t),e=this.getLogsRange(s);if(a[0]>e[1])l=l.concat(s,t);else if(a[1]<e[0])l=l.concat(t,s);else{const i=Math.max(a[0],e[0]),n=Math.min(a[1],e[1]),o=s.findIndex((a=>Math.abs(parseFloat(a.lineNum)-i)<.001)),g=s.findIndex((a=>Math.abs(parseFloat(a.lineNum)-n)<.001));l=s.slice(),l.splice(o,g-o+1,...t)}}else l=t;l=l.map((a=>Object.freeze(a))),this.logs={...this.logs,[e+"_"+this.currentInstanceId]:l}},getLogsRange:a=>[parseFloat(a[0].lineNum),parseFloat(a[a.length-1].lineNum)],handleScrollTop(a){this.onPull(a)},toggle(){this.expandAll=!this.expandAll,this.$emit("expand",this.expandAll),this.expandAll&&this.$nextTick((()=>{this.$el.scrollIntoView()}))}}},ha=(0,h.A)(Ia,[["render",function(a,e,t,l,n,o){const g=(0,s.g2)("el-option"),c=(0,s.g2)("el-select"),r=(0,s.g2)("LoggerScroll"),d=(0,s.g2)("ArrowDownBold"),u=(0,s.g2)("el-icon"),I=(0,s.g2)("ArrowUpBold");return(0,s.uX)(),(0,s.CE)("div",B,[(0,s.Q3)(" main tab "),(0,s.Lk)("div",W,[(0,s.Lk)("div",O,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.mainTabs,((a,e)=>((0,s.uX)(),(0,s.CE)("span",{key:e,class:(0,i.normalizeClass)({"f-log-tab--active":n.currentMainTab===e}),onClick:a=>o.changeMainTab(e)},(0,i.toDisplayString)(o.capitalize(e))+" Log",11,Q)))),128))]),o.instanceSelection.length>1?((0,s.uX)(),(0,s.Wv)(c,{key:0,modelValue:n.currentInstanceId,"onUpdate:modelValue":e[0]||(e[0]=a=>n.currentInstanceId=a),size:"mini"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.instanceSelection,(a=>((0,s.uX)(),(0,s.Wv)(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(0,s.Q3)("v-if",!0)]),(0,s.Q3)(" sub tab "),(0,s.Lk)("section",J,[(0,s.Lk)("div",U,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.mainTabs[n.currentMainTab].tabs,((a,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:(0,i.normalizeClass)([{"f-log-subtab--active":o.currentLogType===e},"f-log-subtab"]),onClick:a=>o.changeSubTab(e)},[(0,s.Lk)("span",$,(0,i.toDisplayString)(a),1),n.counts[e]>0?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,i.normalizeClass)(["f-log-subtab-count",`f-log-${a}-total`])},(0,i.toDisplayString)(n.counts[e]),3)):(0,s.Q3)("v-if",!0)],10,V)))),128))]),(0,s.Lk)("div",q,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.LOG_TYPES,((a,e)=>(0,s.bo)(((0,s.uX)(),(0,s.Wv)(r,{key:a,logs:n.logs[a+"_"+n.currentInstanceId],onScrollTop:e=>o.handleScrollTop(a),class:"f-dashboard-logger"},null,8,["logs","onScrollTop"])),[[X.vShow,o.currentLogType===a]]))),128))])]),(0,s.Q3)(" other "),(0,s.Lk)("div",aa,[(0,s.bo)((0,s.Lk)("section",{class:"f-log-clickable",onClick:e[1]||(e[1]=(...a)=>o.toggle&&o.toggle(...a))},[(0,s.bF)(u,{size:30},{default:(0,s.k6)((()=>[(0,s.bF)(d,{class:"f-log-svg"})])),_:1})],512),[[X.vShow,n.expandAll]]),(0,s.bo)((0,s.Lk)("section",{class:"f-log-clickable",onClick:e[2]||(e[2]=(...a)=>o.toggle&&o.toggle(...a))},[(0,s.bF)(u,{size:30},{default:(0,s.k6)((()=>[(0,s.bF)(I,{class:"f-log-svg"})])),_:1})],512),[[X.vShow,!n.expandAll]])],512)])}],["__scopeId","data-v-38b7b40a"]]),ba={class:"f-dashboard"},Ca={class:"f-dashboard-header"},pa={class:"f-dashboard-main"},fa=(0,s.pM)({__name:"Dashboard",setup(a){const e=(0,l.KR)(!1),t=a=>{e.value=a};return(a,o)=>((0,s.uX)(),(0,s.CE)("section",ba,[(0,s.Lk)("section",Ca,[(0,s.bF)((0,l.R1)(n.L))]),(0,s.Lk)("section",pa,[(0,s.Lk)("section",{class:(0,i.normalizeClass)(["f-dashboard-information",{"f-dashboard-information--expend":e.value}])},[(0,s.bF)(H,{class:"f-dashboard-item f-dashboard-info"}),(0,s.bF)(j,{class:"f-dashboard-item f-dasboard-guage"}),(0,s.bF)(b,{class:"f-dashboard-item f-dashboard-dag"})],2),(0,s.Lk)("section",{class:(0,i.normalizeClass)(["f-dashboard-log",{"f-dashboard-log--expend":e.value}])},[(0,s.bF)(ha,{onExpand:t})],2)])]))}}),ma=(0,h.A)(fa,[["__scopeId","data-v-d883f262"]])}}]);