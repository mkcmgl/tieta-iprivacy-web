"use strict";(self.webpackChunkfate_board=self.webpackChunkfate_board||[]).push([[448],{12448:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var l=a(32288),o=a(12416),r=a(51784),s=a(9596),n=a(73709),i=a(72746),u=a(42877);const d=(0,l.pM)({__name:"Filter",props:["role","status"],emits:["search","resize"],setup(e,{emit:t}){const a=t,r=(0,o.Kh)({job_id:"",role:[],party_id:"",partner:"",status:[],note:""}),s=(0,o.KR)();let n;return(0,l.sV)((()=>{const e=()=>{if(s.value.getBoundingClientRect){const e=s.value.getBoundingClientRect();a("resize",e)}};e(),n=(0,u.resizeObserve)(e),n.observer(s.value)})),(0,l.xo)((()=>{n&&(n.unobserver(),n=void 0)})),(t,a)=>{const o=(0,l.g2)("el-input"),n=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-option"),d=(0,l.g2)("el-select"),c=(0,l.g2)("el-form"),p=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)("section",{ref_key:"filterContainer",ref:s,class:"h-filter"},[(0,l.bF)(c,{inline:!0,model:r,"label-width":"70px",class:"h-filter-form",onKeydown:a[11]||(a[11]=(0,i.withKeys)((e=>t.$emit("search",r)),["enter"]))},{default:(0,l.k6)((()=>[(0,l.bF)(n,{label:"Job ID"},{default:(0,l.k6)((()=>[(0,l.bF)(o,{modelValue:r.job_id,"onUpdate:modelValue":a[0]||(a[0]=e=>r.job_id=e),size:"small",clearable:"",onClear:a[1]||(a[1]=e=>t.$emit("search",r))},null,8,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"Role"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:r.role,"onUpdate:modelValue":a[2]||(a[2]=e=>r.role=e),size:"small",placeholder:" ",clearable:"","collapse-tags":"",multiple:"",onClear:a[3]||(a[3]=e=>t.$emit("search",r))},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.role,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"Party ID"},{default:(0,l.k6)((()=>[(0,l.bF)(o,{modelValue:r.party_id,"onUpdate:modelValue":a[4]||(a[4]=e=>r.party_id=e),size:"small",clearable:"",onClear:a[5]||(a[5]=e=>t.$emit("search",r))},null,8,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"Partner"},{default:(0,l.k6)((()=>[(0,l.bF)(o,{modelValue:r.partner,"onUpdate:modelValue":a[6]||(a[6]=e=>r.partner=e),size:"small",clearable:"",onClear:a[7]||(a[7]=e=>t.$emit("search",r))},null,8,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"Status"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:r.status,"onUpdate:modelValue":a[8]||(a[8]=e=>r.status=e),size:"small",placeholder:" ",clearable:"","collapse-tags":"",multiple:"",onClear:a[9]||(a[9]=e=>t.$emit("search",r))},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.status,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(n,{label:"Note"},{default:(0,l.k6)((()=>[(0,l.bF)(o,{modelValue:r.note,"onUpdate:modelValue":a[10]||(a[10]=e=>r.note=e),size:"small",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,l.bF)(p,{type:"primary",round:"",size:"small",class:"h-filter-btn",onClick:a[12]||(a[12]=e=>t.$emit("search",r))},{default:(0,l.k6)((()=>[(0,l.eW)("Search")])),_:1})],512)}}});var c=a(47433);const p=(0,c.A)(d,[["__scopeId","data-v-34aa8588"]]);var b=a(93935),m=a(66500),h=a(45250),f=a(57511),_=a(17997),v=a(45723),w=a(15644);const g=(e,t,a)=>[{type:"link",prop:"jobId",label:"ID",width:250,showOverflowTooltip:!0,onClick:({row:e})=>{if(_.A.commit("SET_JOBID",e.jobId),_.A.commit("SET_JOB_ROLE",e.role),_.A.commit("SET_PARTYID",e.partyId),window&&_.A.state.job._blank_){const t=f.A.resolve({name:"detail",path:"/detail",params:{jobId:e.jobId,role:e.role,partyId:e.partyId}});window.open(t.href,"_blank")}else _.A.dispatch("toDetail",e)}},{prop:"role",label:"Role",width:100,showOverflowTooltip:!0},{prop:"partyId",label:"Party ID",width:100,showOverflowTooltip:!0},{prop:"partner",label:"Partner",width:100,showOverflowTooltip:!0},{prop:"start_time",label:"Start Time",width:200,sortable:"custom",showOverflowTooltip:!0},{prop:"end_time",label:"End Time",width:200,sortable:"custom",showOverflowTooltip:!0},{prop:"duration",label:"Duration",width:130,sortable:"custom",showOverflowTooltip:!0},{type:"progress",prop:"status",label:"Status",width:150,showOverflowTooltip:!0},{type:"edit",prop:"notes",label:"Notes",minWidth:170,onEdit:(t,a)=>{!async function(e,t,a){const{row:l}=t;await b.A.noteUpdate({job_id:l.jobId,party_id:l.partyId,role:l.role,notes:void 0!==e.value?e.value:e})?a(e,t):(0,w.nk)({showClose:!0,message:"Notes updating failed",center:!0,type:"warning"})}(t,a,e)}},{type:"action",prop:"action",label:"Action",width:100,fixed:"right",operations:e=>{if(e.row)return e.row.status.value.match(/(fail|cancel)/i)?[{label:"retry",onClick:({row:e})=>{var t;t={job_id:e.jobId},v.s.confirm("The job will continue from where it end, it may take few seconds to  update job status.","Retry",{confirmButtonText:"Sure",cancelButtonText:"Cancel",type:"warning"}).then((()=>_.A.dispatch("retryJob",t))).catch((()=>{}))}}]:e.row.status.value.match(/running/i)?[{label:"cancel",onClick:({row:a})=>{var l,o;l={job_id:a.jobId},o=()=>t(e),v.s.confirm("Are you sure you want to cancel this job? You can't undo this actionï¼Œit may take few seconds to  update job status.","Cancel",{confirmButtonText:"Sure",cancelButtonText:"Cancel",type:"warning"}).then((()=>{b.A.killJob(l).then((e=>{e?((0,w.nk)({type:"success",message:"Job is canceling"}),o()):(0,w.nk)({type:"error",message:"Job-canceling failed"})}))})).catch((()=>{}))}}]:void 0}}],y=(0,l.pM)({__name:"Table",setup(e,{expose:t}){const a=(0,n.Pj)(),r=(0,o.KR)(),s=(0,o.KR)(!0),i=(0,l.EW)((()=>g(((e,{$index:t})=>{_[t].notes=e}),(()=>v())))),u=(0,o.Kh)({pageNum:a.state.job.currentPage||1,pageSize:a.state.job.pageSize||20,orderRule:"desc",orderField:"f_job_id",job_id:"",role:[],party_id:"",partner:"",status:[],note:""}),d=(0,o.KR)(0),c=e=>{u.pageSize=e,a.commit("SET_PAGESIZE",e)},p=e=>{u.pageNum=e,a.commit("SET_CURRENTPAGE",e)},f=({col:e,order:t})=>{u.orderRule="descending"===t?"desc":"asc",u.orderField={start_time:"f_start_time",end_time:"f_end_time",duration:"f_elapsed"}[e]},_=(0,o.Kh)([]),v=(0,h.debounce)((async()=>{const e=await b.A.queryJobs(u);d.value=e.totalRecord,_.length=0,_.push(...e.list.map((({job:e})=>({jobId:e.fJobId||"",role:e.fRole||"",partyId:e.fPartyId||"",start_time:e.fStartTime?(0,m.toDate)(e.fStartTime):"",end_time:e.fEndTime?(0,m.toDate)(e.fEndTime):"",duration:(e.fStatus||"waiting").match(/waiting|running/i)?"":e.fElapsed?(0,m.toTime)(e.fElapsed):"",partner:e.partners.join(", "),status:{value:e.fStatus||"waiting",percentage:e.fStatus.match(/running/i)?e.fProgress||0:void 0,className:e=>e.match(/success/i)?"f-status-success":e.match(/fail/)?"f-status-fail":""},notes:e.fDescription||""})))),(0,l.dY)((()=>{s.value=!1}))}),500);let w;return(0,l.wB)((()=>u),(()=>{v()}),{deep:!0}),(0,l.KC)((()=>{s.value=!0,v(),w=setInterval((()=>{v()}),15e3)})),(0,l.sV)((()=>{setTimeout((()=>{s.value=!1}),4e3)})),(0,l.xo)((()=>{w&&clearInterval(w)})),t({search:e=>{Object.assign(u,e),u.pageNum=1,r.value.pageChange(u.pageNum)}}),(e,t)=>{const a=(0,l.g2)("FTable"),o=(0,l.gN)("loading");return(0,l.bo)(((0,l.uX)(),(0,l.Wv)(a,{ref_key:"ftable",ref:r,header:i.value,data:_,current:u.pageNum,size:u.pageSize,total:d.value,layout:"total, sizes, prev, pager, next",needToRefresh:!1,position:"center",class:"f-history-table",onSizeChange:c,onCurrentChange:p,onSortChange:f},null,8,["header","data","current","size","total"])),[[o,s.value]])}}}),k=y,T={class:"h-list"},C={class:"h-list-header"},I={class:"h-list-body"},j=(0,l.pM)({__name:"History",setup(e){const t=(0,n.Pj)(),a=(0,l.EW)((()=>{const e=t.state.assets.role;return e?e.reduce(((e,t)=>(e.push({label:t,value:t}),e)),[]):[]})),i=(0,l.EW)((()=>{const e=t.state.assets.status;return e?e.reduce(((e,t)=>(e.push({label:t,value:t}),e)),[]):[]})),u=(0,o.KR)(),d=e=>{u.value.search(e)},c=(0,o.Kh)({}),b=e=>{c.height=`calc(100% - ${e.height+24}px)`};return(e,t)=>((0,l.uX)(),(0,l.CE)("section",T,[(0,l.Lk)("header",C,[(0,l.bF)((0,o.R1)(s.L))]),(0,l.Lk)("main",I,[(0,l.bF)(p,{ref:"filter",role:a.value,status:i.value,onSearch:d,onResize:b,class:"h-list-filter"},null,8,["role","status"]),(0,l.bF)(k,{ref_key:"table",ref:u,class:"h-list-table",style:(0,r.normalizeStyle)(c)},null,8,["style"])])]))}}),S=(0,c.A)(j,[["__scopeId","data-v-f21e5096"]])}}]);